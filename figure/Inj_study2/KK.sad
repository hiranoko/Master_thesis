!******************************************************************** 
!* PF-RING Super-Low Emittance Lattice Configuration * 
!* Normal Cell Phase Addvance 115 deg Version * 
!* Straight Section reinforcement * 
!* Second edition with PMs & STRs * 
!* SEXTUPOLE(SF,SD) 2 FAMILY CORRECTION * 
!* Octupole * 
!********************************************************************

 MOMENTUM=2.5 GEV;

 MARK   MKD   =()
        MKASYMST =()

        INJ   =()
        RMARK =()
        HMARK =()
        SMARK =()
        TMARK =()

        U02   =(bx=9 by=4 ax=0 ay=0 ex=0 epx=0)
        U03   =()
        U04   =()
        U05   =()
        U13   =()
        U14   =()
        U15   =()
        U16   =()
        U17   =()
        U18   =()
        U19   =()
        U26   =()
        U28   =()
        U01   =()
        MKSNWS  = ()
        MKSNES  = ()
        MKSSWS  = ()
        MKSSES  = ()
        MKNCWS  = ()
        MKNCES  = ()

        MKSNWE  = ()
        MKSNEE  = ()
        MKSSWE  = ()
        MKSSEE  = ()
        MKNCWE  = ()
        MKNCEE  = ()
        MKBUMPE = ()

        DM      = ()
        MPM     = ()
        MPHV    = ()
        MPHVM   = ()
        MPHVG   = ()
 ;
 MONI
        PM      =()
 ;
 CAVI   CAVI=(VOLT= 1000000 FREQ=499990264.8)
 ;
 BEND   B02     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B03     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B04     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B05     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B06     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B07     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B08     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B09     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B10     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B11     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B12     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B13     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B14     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B15     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B16     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B17     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B18     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B19     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B20     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B21     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B22     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B23     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B24     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B25     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B26     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B27     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B28     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
        B01     =(L = 1.942696 ANGLE = 0.22439947525641380274733167023425  E1 = 0.5 E2=0.5)
 ;
 BEND   VD      =(L = 0.15 K0 = 0     ROTATE =-90 DEG )
        PV      =(L = 0    K0 = 0     ROTATE =-90 DEG ) 
        PH      =(L = 0    K0 = 0  )
        VS      =(L = 0    K0 = 0     ROTATE =-90 DEG)

        KK1      = (L = 0.3 )
        KK2      = (L = 0.3 )
        KK3      = (L = 0.3 )
        KK4      = (L = 0.3 )
 ;
 QUAD   SQ      =(L = 0   K1 = .0 ROTATE=45  deg)
 ;
 QUAD   Q1      =(L =.4   K1 =.698096426338 )
        Q2      =(L =.4   K1 =-.6928509495915 )
        Q3      =(L =.3   K1 =-.7582257471804 )
        Q4      =(L =.3   K1 =.8485774395228 )
        Q5B     =(L =.4   K1 =-.7477651492198 )
        Q6B     =(L =.4   K1 =.8213108186402 )
        Q7B     =(L =.3   K1 =.3716972819766 )
        Q8B     =(L =.4   K1 =-.8474940261361 )
        Q9B     =(L =.4   K1 =.8733651289326 )
        QAB     =(L =.3   K1 =.2752712073638 )
        QDB     =(L =.25  K1 =-.516490934853 )
        QFB     =(L =.4   K1 =.77169828379 )
        QD      =(L =.25  K1 =-.4791910620324 )
        QF      =(L =.4   K1 =.748319526303 )
        QFA     =(L =.4   K1 =.7268201874174 )
        QDA     =(L =.25  K1 =-.5977851575315 )
        QAA     =(L =.4   K1 =.4027138035082 )
        Q9A     =(L =.4   K1 =.8879679595581 )
        Q8A     =(L =.4   K1 =-.9208219644329 )
        Q7A     =(L =.3   K1 =.359209262548 )
        Q6A     =(L =.4   K1 =.8530844358661 )
        Q5A     =(L =.4   K1 =-.753353015542 )
 ;
 SEXT   SFH     =(L =.1   K2 =3.9242032090679 )
        SDH     =(L =.1   K2 =-3.9053258695379 )
 ;
 OCT    OCT     =(L = .2   K3 =  .0 )
 ;
 DRIFT  LLS1    =(L = 4.365 )
        L250    =(L = 0.25 )
        L400    =(L = 0.4 )
        L350    =(L = 0.35 )
        LLS2    =(L = 0.605 )
        LLS3    =(L = 2.605 )
        LLS32   =(L = 2.455 )
        LLS33   =(L = 2.405 )
        LLS34   =(L = 1.805 ) 
        LLS4    =(L = 2.545 )
        LLS42   =(L = 2.595 )
        L110    =(L = 0.11 )
        L300    =(L = 0.3 )
        L100    =(L = 0.1 )    
        L600    =(L = 0.6 )
        L200    =(L = 0.2 )
        L325    =(L = 0.325 )
        LLS5    =(L = 2.2125 )
        LLS51   =(L = 2.2625 )
        LLS52   =(L = 1.7125 )
        LLS53   =(L = 1.6625 )
! modified lattice at injection point 
        LLS230   =(L = 0.230 )
        LLS522   =(L = 2.630 )
        LLS533   =(L = 0.685 )
        LLS280   =(L = 0.280 )

        L050    =(L = 0.05 )
        L075    =(L = 0.075)
        L060    =(L = 0.060)
        L090    =(L = 0.090)
        L460    =(L = 0.460)
        L130    =(L = 0.130) 
        L225    =(L = 0.225)
        L220    =(L = 0.220)
        L500    =(L = 0.5 )
        L080    =(L = 0.080)
        L150    =(L = 0.15)
 ;

LINE
        PHV    = (PH PV) 
        STRNW  =(MKSNWS
                 U02  LLS1  PHV   L050   PM     L050
                 Q1   L050  VD    L050 
                 Q2   L050  PM    L050   MPHVM  L300
                 B02  L250  PHV   L050   PM     L050
                 Q3   L050  VD    L050
                 Q4   L050  MPM   L050   MPHVG  LLS2
                 U03  LLS2  MPHVG L050   MPM    L050
                 Q4   L050  VD    L050   
                 Q3   L050  PM    L050   MPHVG  L250
                 B03  L300  PHV   L050   MPM    L050
                 Q5B  L050  VD    L050
                 Q6B  L050  PM    L050   MPHV   LLS3
                 CAVI LLS32 VD    L050   PM     L050
                 Q7B  L400
                 B04  L300  PHV   L050   PM     L050
                 Q8B  L050  VD    L050
                 Q9B  L050  PM    L050   MPHVG  LLS4
                 U05  LLS4  PHV   L050   PM     L050
                 QAB L110 SFH VS   SFH  L250 MPHVM L050
                 B05 L300  
                 QDB L050 PM  L050 SDH  VS    SDH   L220  
                 OCT  L080  PHV   L050 PM L050
                 QFB
                 MKSNWE) 

        NCELW  =(MKNCWS
                 L100            SFH  SQ SFH   L200            B06    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B07    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B08    L300  QD
                 L050  PM  L050  SDH  VS SDH   L220  OCT  
                                               L080  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B09    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B10    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B11    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050
                 MKNCWE)

        STRSW  =(MKSSWS
                 QFA L100 SFH SQ    SFH L200
                 B12 L300
                 QDA L050 PM  L050  SDH VS   SDH  L225  MPHVM  L100
                 QAA L050 PM  L050  PHV LLS5
                 U13 LLS5 PHV L050  PM  L050
                 Q9A L050 VD    L050 
                 Q8A L050 MPHVM L050 PM    L300
                 B13 L300 PHV   L100
                 Q7A L050 PM    L050 VD    L050  MPHVM  LLS33
                 U14 LLS3 MPHVM L050 MPM   L050
                 Q6A L050 VD    L050
                 Q5A L050 PM    L050 MPHVM L300
                 B14 L250 PHV   L050 PM    L050
                 Q3  L050 VD    L050
                 Q4  L050 MPM   L050 MPHVG LLS2
                 U15 LLS2 MPHVG L050 MPM   L050
                 Q4  L050 VD    L050
                 Q3  L050 PM    L050 MPHVG L250
                 B15 L300 PHV   L050 PM    L050
                 Q2  L050 VD    L050
                 Q1  L050 PM    L050 MPHVM LLS1
                 MKSSWE)

        STRSE  =(MKSSES
                 U16  LLS1  PHV   L050   PM     L050
                 Q1   L050  VD    L050
                 Q2   L050  PM    L050   MPHVM  L300
                 B16  L250  PHV   L050   PM     L050
                 Q3   L050  VD    L050
                 Q4   L050  MPM   L050   MPHVG  LLS2
                 U17  LLS2  MPHVG L050   MPM    L050
                 Q4   L050  VD    L050
                 Q3   L050  PM    L050   MPHVG  L250
                 B17  L300  PHV   L050   MPM    L050
                 Q5B  L050  VD    L050
                 Q6B  L050  PM    L050   MPHV   LLS3
                 CAVI LLS32 VD    L050   PM     L050
                 Q7B  L400
                 B18  L300  PHV   L050   PM     L050
                 Q8B  L050  VD    L050
                 Q9B  L050  PM    L050   MPHVM  LLS4
                 U19  LLS4  PHV   L050   PM     L050

                 QAB L110 SFH VS   SFH  L250  MPHVM  L050
                 B19 L300
                 QDB L050 PM  L050 SDH  VS    SDH    L220
                                   OCT  L080  PHV    L050 PM L050
                 QFB
                 MKSSEE)

        NCELE  =(MKNCES
                 L100            SFH  SQ SFH   L200            B20    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B21    L300  QD
                 L050  PM  L050  SDH  VS SDH   L220  OCT
                                               L080  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B22    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B23    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B24    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B25    L300  QD
                 L050  PM  L050  SDH  VS SDH   
                 L500       L050        L050
                 MKNCEE)

        NCELEINJ0  =(MKNCES
                 L100            SFH  SQ SFH   L200            B20    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B21    L300  QD
                 L050  PM  L050  SDH  VS SDH   L220  OCT
                                               L080  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B22    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B23    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B24    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF

                 L100            SFH  SQ SFH   L200            B25    L300  QD
                 L050  PM  L050  SDH  VS SDH
                 L150  K1    L150
                 MKNCEE)
                 
        NCELEINJ1  =(MKNCES
                 L100            SFH  SQ SFH   L200            B20    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B21    L300  QD
                 L050  PM  L050  SDH  VS SDH   L220  OCT
                                               L080  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B22    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B23    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B24    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF

                 L100            SFH  SQ SFH   L200            B25    L300  QD
                 L050  PM  L050  SDH  VS SDH
                 L150  KK1    L150
                 MKNCEE)
                 
        NCELEINJ2  =(MKNCES
                 L100            SFH  SQ SFH   L200            B20    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B21    L300  QD
                 L050  PM  L050  SDH  VS SDH   L220  OCT
                                               L080  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B22    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B23    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B24    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF

                 L100            SFH  SQ SFH   L200            B25    L300  QD
                 L050  PM  L050  SDH  VS SDH
                 L150  KKK1    L150
                 MKNCEE)
                 
        NCELEINJ3  =(MKNCES
                 L100            SFH  SQ SFH   L200            B20    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B21    L300  QD
                 L050  PM  L050  SDH  VS SDH   L220  OCT
                                               L080  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B22    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B23    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B24    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF

                 L100            SFH  SQ SFH   L200            B25    L300  QD
                 L050  PM  L050  SDH  VS SDH
                 L150  KKKK1    L150
                 MKNCEE)

        NCELEINJ4  =(MKNCES
                 L100            SFH  SQ SFH   L200            B20    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B21    L300  QD
                 L050  PM  L050  SDH  VS SDH   L220  OCT
                                               L080  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B22    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B23    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF
                 L100            SFH  SQ SFH   L200            B24    L300  QD
                 L050  PM  L050  SDH  VS SDH   L500  PHV  L050    PM  L050  QF

                 L100            SFH  SQ SFH   L200            B25    L300  QD
                 L050  PM  L050  SDH  VS SDH
                 L150  KKKKK1    L150
                 MKNCEE)
                 
        STRNE  =(MKSNES
                 QFA L100 SFH SQ    SFH L200
                 B26 L300
                 QDA L050 PM    L050  SDH VS  SDH  L225  MPHV  L100
                 QAA
                 L050 PM    L050  PHV   LLS5
                 INJ LLS5 MPHV  L050  PM    L050
                 Q9A L050 VD    L050
                 Q8A L050 PM    L050  PHV   L300
                 B27 L300 MPHVM L100
                 Q7A L050 PM    L050  VD    L050  MPHVM  
                 LLS33
                 U28 LLS3 MPHVM L050  PM    L050
                 Q6A L050 VD    L050
                 Q5A L050 MPM   L050  PHV   L300
                 B28 L250 MPHVM L050  PM    L050
                 Q3  L050 VD    L050
                 Q4  L050 MPM   L050  MPHV  LLS2
                 U01 LLS2 MPHVG L050  MPM   L050
                 Q4  L050 VD    L050
                 Q3  L050 PM    L050  MPHVG L250
                 B01 L300 PHV   L050  PM    L050
                 Q2  L050 VD    L050
                 Q1  L050 PM    L050  MPHVM LLS1
                 MKSNEE)

        STRNEINJ0  =(MKSNES
                 QFA L100 SFH SQ    SFH L200
                 B26 L300
                 QDA L050 PM    L050  SDH VS  SDH  L225  MPHV  L100
                 QAA
                 L050 PM    L050  PHV LLS230 K2  LLS522
                 INJ  LLS533 K3 LLS280 MPHV  L050  PM    L050
                 Q9A L050 VD    L050
                 Q8A L050 PM    L050  PHV   L300
                 B27 L300 MPHVM L100
                 Q7A L050 PM    L050  VD    L050  MPHVM
                 L300 K4 MKBUMPE LLS34
                 U28 LLS3 MPHVM L050  PM    L050
                 Q6A L050 VD    L050
                 Q5A L050 MPM   L050  PHV   L300
                 B28 L250 MPHVM L050  PM    L050
                 Q3  L050 VD    L050
                 Q4  L050 MPM   L050  MPHV  LLS2
                 U01 LLS2 MPHVG L050  MPM   L050
                 Q4  L050 VD    L050
                 Q3  L050 PM    L050  MPHVG L250
                 B01 L300 PHV   L050  PM    L050
                 Q2  L050 VD    L050
                 Q1  L050 PM    L050  MPHVM LLS1
                 MKSNEE)
                 
        STRNEINJ1  =(MKSNES
                 QFA L100 SFH SQ    SFH L200
                 B26 L300
                 QDA L050 PM    L050  SDH VS  SDH  L225  MPHV  L100
                 QAA
                 L050 PM    L050  PHV LLS230 KK2  LLS522
                 INJ  LLS533 KK3 LLS280 MPHV  L050  PM    L050
                 Q9A L050 VD    L050
                 Q8A L050 PM    L050  PHV   L300
                 B27 L300 MPHVM L100
                 Q7A L050 PM    L050  VD    L050  MPHVM
                 L300 KK4 MKBUMPE LLS34
                 U28 LLS3 MPHVM L050  PM    L050
                 Q6A L050 VD    L050
                 Q5A L050 MPM   L050  PHV   L300
                 B28 L250 MPHVM L050  PM    L050
                 Q3  L050 VD    L050
                 Q4  L050 MPM   L050  MPHV  LLS2
                 U01 LLS2 MPHVG L050  MPM   L050
                 Q4  L050 VD    L050
                 Q3  L050 PM    L050  MPHVG L250
                 B01 L300 PHV   L050  PM    L050
                 Q2  L050 VD    L050
                 Q1  L050 PM    L050  MPHVM LLS1
                 MKSNEE)
                 
        STRNEINJ2  =(MKSNES
                 QFA L100 SFH SQ    SFH L200
                 B26 L300
                 QDA L050 PM    L050  SDH VS  SDH  L225  MPHV  L100
                 QAA
                 L050 PM    L050  PHV LLS230 KKK2  LLS522
                 INJ  LLS533 KKK3 LLS280 MPHV  L050  PM    L050
                 Q9A L050 VD    L050
                 Q8A L050 PM    L050  PHV   L300
                 B27 L300 MPHVM L100
                 Q7A L050 PM    L050  VD    L050  MPHVM
                 L300 KKK4 MKBUMPE LLS34
                 U28 LLS3 MPHVM L050  PM    L050
                 Q6A L050 VD    L050
                 Q5A L050 MPM   L050  PHV   L300
                 B28 L250 MPHVM L050  PM    L050
                 Q3  L050 VD    L050
                 Q4  L050 MPM   L050  MPHV  LLS2
                 U01 LLS2 MPHVG L050  MPM   L050
                 Q4  L050 VD    L050
                 Q3  L050 PM    L050  MPHVG L250
                 B01 L300 PHV   L050  PM    L050
                 Q2  L050 VD    L050
                 Q1  L050 PM    L050  MPHVM LLS1
                 MKSNEE)
                 
        STRNEINJ3  =(MKSNES
                 QFA L100 SFH SQ    SFH L200
                 B26 L300
                 QDA L050 PM    L050  SDH VS  SDH  L225  MPHV  L100
                 QAA
                 L050 PM    L050  PHV LLS230 KKKK2  LLS522
                 INJ  LLS533 KKKK3 LLS280 MPHV  L050  PM    L050
                 Q9A L050 VD    L050
                 Q8A L050 PM    L050  PHV   L300
                 B27 L300 MPHVM L100
                 Q7A L050 PM    L050  VD    L050  MPHVM
                 L300 KKKK4 MKBUMPE LLS34
                 U28 LLS3 MPHVM L050  PM    L050
                 Q6A L050 VD    L050
                 Q5A L050 MPM   L050  PHV   L300
                 B28 L250 MPHVM L050  PM    L050
                 Q3  L050 VD    L050
                 Q4  L050 MPM   L050  MPHV  LLS2
                 U01 LLS2 MPHVG L050  MPM   L050
                 Q4  L050 VD    L050
                 Q3  L050 PM    L050  MPHVG L250
                 B01 L300 PHV   L050  PM    L050
                 Q2  L050 VD    L050
                 Q1  L050 PM    L050  MPHVM LLS1
                 MKSNEE)

        STRNEINJ4  =(MKSNES
                 QFA L100 SFH SQ    SFH L200
                 B26 L300
                 QDA L050 PM    L050  SDH VS  SDH  L225  MPHV  L100
                 QAA
                 L050 PM    L050  PHV LLS230 KKKKK2  LLS522
                 INJ  LLS533 KKKKK3 LLS280 MPHV  L050  PM    L050
                 Q9A L050 VD    L050
                 Q8A L050 PM    L050  PHV   L300
                 B27 L300 MPHVM L100
                 Q7A L050 PM    L050  VD    L050  MPHVM
                 L300 KKKKK4 MKBUMPE LLS34
                 U28 LLS3 MPHVM L050  PM    L050
                 Q6A L050 VD    L050
                 Q5A L050 MPM   L050  PHV   L300
                 B28 L250 MPHVM L050  PM    L050
                 Q3  L050 VD    L050
                 Q4  L050 MPM   L050  MPHV  LLS2
                 U01 LLS2 MPHVG L050  MPM   L050
                 Q4  L050 VD    L050
                 Q3  L050 PM    L050  MPHVG L250
                 B01 L300 PHV   L050  PM    L050
                 Q2  L050 VD    L050
                 Q1  L050 PM    L050  MPHVM LLS1
                 MKSNEE)

        SF     = (SFH SFH)
        SD     = (SDH SDH)
   RING    = (NCELE STRNE RMARK STRNW NCELW STRSW STRSE)
   TEST = (NCELEINJ0 STRNEINJ0 RMARK STRNW NCELW STRSW STRSE
           NCELEINJ1 STRNEINJ1 RMARK STRNW NCELW STRSW STRSE
           NCELEINJ2 STRNEINJ2 RMARK STRNW NCELW STRSW STRSE
           NCELEINJ3 STRNEINJ3 RMARK STRNW NCELW STRSW STRSE RING)
   INJRING = (NCELEINJ1 STRNEINJ1)
 ;
 MARK   INJ     =(AX =-1.4499438809074   BX =11.2030448319266
           PSIX =12.0690454026648   AY =-1.2555908530403
           BY =1.643837182309  PSIY =4.82123115734 EX =.6424248321704
           EPX =.0493810515298 DX =.012  DPX =-1.8555315501E-18
           DZ =-8.93494473393E-4    DP =.01   EMITX =3.552075878412E-8
           EMITY =1E-12 )
 ;
 BEND
        K1      =(L =.3   ANGLE =0  K0 =0)
        K2      =(L =.3   ANGLE =0  K0 =0)
        K3      =(L =.3   ANGLE =0  K0 =0)
        K4      =(L =.3   ANGLE =0  K0 =0)
        KK1     =(L =.3   ANGLE =0  K0 =0)
        KK2     =(L =.3   ANGLE =0  K0 =0)
        KK3     =(L =.3   ANGLE =0  K0 =0)
        KK4     =(L =.3   ANGLE =0  K0 =0)
        KKK1    =(L =.3   ANGLE =0  K0 =0)
        KKK2    =(L =.3   ANGLE =0  K0 =0)
        KKK3    =(L =.3   ANGLE =0  K0 =0)
        KKK4    =(L =.3   ANGLE =0  K0 =0)
        KKKK1   =(L =.3   ANGLE =0  K0 =0)
        KKKK2   =(L =.3   ANGLE =0  K0 =0)
        KKKK3   =(L =.3   ANGLE =0  K0 =0)
        KKKK4   =(L =.3   ANGLE =0  K0 =0)
        KKKKK1  =(L =.3   ANGLE =0  K0 =0)
        KKKKK2  =(L =.3   ANGLE =0  K0 =0)
        KKKKK3  =(L =.3   ANGLE =0  K0 =0)
        KKKKK4  =(L =.3   ANGLE =0  K0 =0)
 ;
 ;

!+
!      display command
!-

 ON LOG;
 ON RAD FLUC COD RFSW RADCOD; 
 FFS;

 Get["modules_general.n"];
 $FORM = "15.10";
 PageWidth = 1999;
 USE TEST;
 cell;
 calc;
 emit;
 SAVE ALL;

	pmnam = {"PM.130","PM.131","PM.132","PM.133","PM.134","PM.135","PM.136","PM.137","PM.138","PM.139","PM.140","PM.141","PM.142","PM.143","PM.144","PM.145","PM.146","PM.147","PM.148","PM.149","PM.150","PM.151","PM.152","PM.153","PM.154","PM.155","PM.156","PM.157","PM.158","PM.159","PM.160","PM.161","PM.162","PM.163","PM.164","PM.165","PM.166","PM.167","PM.168","PM.169","PM.170","PM.171","PM.172","PM.173","PM.174","PM.175","PM.176","PM.177","PM.178","PM.179","PM.180","PM.181","PM.182","PM.183","PM.184","PM.185","PM.186","PM.187","PM.188","PM.189","PM.190","PM.191","PM.192","PM.193","PM.194","PM.195","PM.196","PM.197","PM.198","PM.199","PM.200","PM.201","PM.202","PM.203","PM.204","PM.205","PM.206","PM.207","PM.208","PM.209","PM.210","PM.211","PM.212","PM.213","PM.214","PM.215","PM.216","PM.217","PM.218","PM.219","PM.220","PM.221","PM.222","PM.223","PM.224","PM.225","PM.226","PM.227","PM.228","PM.229","PM.230","PM.231","PM.232","PM.233","PM.234","PM.235","PM.236","PM.237","PM.238","PM.239","PM.240","PM.241","PM.242","PM.243","PM.244","PM.245","PM.246","PM.247","PM.248","PM.249","PM.250","PM.251","PM.252","PM.253","PM.254","PM.255","PM.256","PM.257","PM.258","PM.259","PM.260","PM.261","PM.262","PM.263","PM.264","PM.265","PM.266","PM.267","PM.268","PM.269","PM.270","PM.271","PM.272","PM.273","PM.274","PM.275","PM.276","PM.277","PM.278","PM.279","PM.280","PM.281","PM.282","PM.283","PM.284","PM.285","PM.286","PM.287","PM.288","PM.289","PM.290","PM.291","PM.292","PM.293","PM.294","PM.295","PM.296","PM.297","PM.298","PM.299","PM.300","PM.301","PM.302","PM.303","PM.304","PM.305","PM.306","PM.307","PM.308","PM.309","PM.310","PM.311","PM.312","PM.313","PM.314","PM.315","PM.316","PM.317","PM.318","PM.319","PM.320","PM.321","PM.322","PM.323","PM.324","PM.325"}
!	pmnam = {"PM.196","PM.197","PM.198","PM.199","PM.200","PM.201","PM.202","PM.203","PM.204","PM.205","PM.206","PM.207","PM.208","PM.209","PM.210","PM.211","PM.212","PM.213","PM.214","PM.215","PM.216","PM.217","PM.218","PM.219","PM.220","PM.221","PM.222","PM.223","PM.224","PM.225","PM.226","PM.227","PM.228","PM.229","PM.230","PM.231","PM.232","PM.233","PM.234","PM.235","PM.236","PM.237","PM.238","PM.239","PM.240","PM.241","PM.242","PM.243","PM.244","PM.245","PM.246","PM.247","PM.248","PM.249","PM.250","PM.251","PM.252","PM.253","PM.254","PM.255","PM.256","PM.257","PM.258","PM.259","PM.260","PM.261","PM.262","PM.263","PM.264","PM.265","PM.266","PM.267","PM.268","PM.269","PM.270","PM.271","PM.272","PM.273","PM.274","PM.275","PM.276","PM.277","PM.278","PM.279","PM.280","PM.281","PM.282","PM.283","PM.284","PM.285","PM.286","PM.287","PM.288","PM.289","PM.290","PM.291","PM.292","PM.293","PM.294","PM.295","PM.296","PM.297","PM.298","PM.299","PM.300","PM.301","PM.302","PM.303","PM.304","PM.305","PM.306","PM.307","PM.308","PM.309","PM.310","PM.311","PM.312","PM.313","PM.314","PM.315","PM.316","PM.317","PM.318","PM.319","PM.320","PM.321","PM.322","PM.323","PM.324","PM.325"}
	pmlen = Length[pmnam];
	Print[pmlen];
	out = OpenWrite["meas.dat"];

	LINE["K0","KK2"] =  .00000;
	
	time1 = 723;
	c1 = -1.72568849917*Power[10,-19]*Power[time1,6]+1.61166702950066*Power[10,-15]*Power[time1,5]-5.6757506896620*Power[10,-12]*Power[time1,4]+8.47657801144718*Power[10,-9]*Power[time1,3]-3.63506651485015*Power[10,-6]*Power[time1,2]-0.00145429726800383*time1;
	time1 -= 625;
	c0 = -1.72568849917*Power[10,-19]*Power[time1,6]+1.61166702950066*Power[10,-15]*Power[time1,5]-5.6757506896620*Power[10,-12]*Power[time1,4]+8.47657801144718*Power[10,-9]*Power[time1,3]-3.63506651485015*Power[10,-6]*Power[time1,2]-0.00145429726800383*time1;
	time1 += 625*2;
	c2 = -1.72568849917*Power[10,-19]*Power[time1,6]+1.61166702950066*Power[10,-15]*Power[time1,5]-5.6757506896620*Power[10,-12]*Power[time1,4]+8.47657801144718*Power[10,-9]*Power[time1,3]-3.63506651485015*Power[10,-6]*Power[time1,2]-0.00145429726800383*time1;
	time1 += 625;
	c3 = -1.72568849917*Power[10,-19]*Power[time1,6]+1.61166702950066*Power[10,-15]*Power[time1,5]-5.6757506896620*Power[10,-12]*Power[time1,4]+8.47657801144718*Power[10,-9]*Power[time1,3]-3.63506651485015*Power[10,-6]*Power[time1,2]-0.00145429726800383*time1;

	LINE["K0","KK1"] = -.00212*c1/c1;
	LINE["K0","K1"] = LINE["K0","KK1"]*c0/c1;
	LINE["K0","KKK1"] = LINE["K0","KK1"]*c2/c1;
	LINE["K0","KKKK1"] = LINE["K0","KK1"]*c3/c1;	
	
For[i=0,i<=20,i=i+1,

	time3 = 732-87;
	Angle3 = -i*.00025;

	a1 = +7.13848726190*Power[10,-20]*Power[time3,6]-2.36458547166570*Power[10,-17]*Power[time3,5]-1.6914613417323*Power[10,-12]*Power[time3,4]+4.18952851287233*Power[10,-9]*Power[time3,3]-1.66401818593536*Power[10,-6]*Power[time3,2]-0.00169864855561666*time3;
	time3 -= 625;
	a0 = +7.13848726190*Power[10,-20]*Power[time3,6]-2.36458547166570*Power[10,-17]*Power[time3,5]-1.6914613417323*Power[10,-12]*Power[time3,4]+4.18952851287233*Power[10,-9]*Power[time3,3]-1.66401818593536*Power[10,-6]*Power[time3,2]-0.00169864855561666*time3;
	time3 += 625*2;
	a2 = +7.13848726190*Power[10,-20]*Power[time3,6]-2.36458547166570*Power[10,-17]*Power[time3,5]-1.6914613417323*Power[10,-12]*Power[time3,4]+4.18952851287233*Power[10,-9]*Power[time3,3]-1.66401818593536*Power[10,-6]*Power[time3,2]-0.00169864855561666*time3;
	time3 += 625;
	a3 = +7.13848726190*Power[10,-20]*Power[time3,6]-2.36458547166570*Power[10,-17]*Power[time3,5]-1.6914613417323*Power[10,-12]*Power[time3,4]+4.18952851287233*Power[10,-9]*Power[time3,3]-1.66401818593536*Power[10,-6]*Power[time3,2]-0.00169864855561666*time3;

	LINE["K0","KK3"] = Angle3;
	LINE["K0","K3"] = LINE["K0","KK3"]*a0/a1;
	LINE["K0","KKK3"] = LINE["K0","KK3"]*a2/a1;
	LINE["K0","KKKK3"] = LINE["K0","KK3"]*a3/a1;	

	For[j=0,j<=20,j=j+1,
	
		time4 = 676-17;	
		Angle4 = -j*.00025;

		b1 = -3.15263587887*Power[10,-19]*Power[time4,6]+2.77203865666483*Power[10,-15]*Power[time4,5]-8.9469801818129*Power[10,-12]*Power[time4,4]+1.22885343873465*Power[10,-8]*Power[time4,3]-5.30743344465427*Power[10,-6]*Power[time4,2]-0.00124138140128771*time4;
		time4 -= 625;
		b0 = -3.15263587887*Power[10,-19]*Power[time4,6]+2.77203865666483*Power[10,-15]*Power[time4,5]-8.9469801818129*Power[10,-12]*Power[time4,4]+1.22885343873465*Power[10,-8]*Power[time4,3]-5.30743344465427*Power[10,-6]*Power[time4,2]-0.00124138140128771*time4;
		time4 += 625*2;	
		b2 = -3.15263587887*Power[10,-19]*Power[time4,6]+2.77203865666483*Power[10,-15]*Power[time4,5]-8.9469801818129*Power[10,-12]*Power[time4,4]+1.22885343873465*Power[10,-8]*Power[time4,3]-5.30743344465427*Power[10,-6]*Power[time4,2]-0.00124138140128771*time4;
		time4 += 625;	
		b3 = -3.15263587887*Power[10,-19]*Power[time4,6]+2.77203865666483*Power[10,-15]*Power[time4,5]-8.9469801818129*Power[10,-12]*Power[time4,4]+1.22885343873465*Power[10,-8]*Power[time4,3]-5.30743344465427*Power[10,-6]*Power[time4,2]-0.00124138140128771*time4;

		LINE["K0","KK4"] = Angle4;
 		LINE["K0","K4"] = LINE["K0","KK4"]*b0/b1;
		LINE["K0","KKK4"] = LINE["K0","KK4"]*b2/b1;
		LINE["K0","KKKK4"] = LINE["K0","KK4"]*b3/b1;

		FFS["ins calc"];
		codx = 0;
		For[k=1,k<pmlen,k+=1,
			codx += Sqrt[Twiss["DX",pmnam[k]]*Twiss["DX",pmnam[k]]];
		];
!		Write[out,-LINE["K0","KK3"],-LINE["K0","KK4"],codx];
		Write[out,-Angle3*1000,-Angle4*1000,codx];	
!		Print[i,j];
	];
	Write[out,"\n"];
];
Close[out];
	
stop;
stop;

!	FFS["draw  dx {KI}*",26];
!	TkWait[];
